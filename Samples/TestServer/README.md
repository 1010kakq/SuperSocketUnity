# Unity SuperSocket 测试服务器

这是一个简单的Node.js测试服务器，用于验证Unity SuperSocket客户端的功能。

## 功能特性

- ✅ TCP连接处理
- ✅ Unity SuperSocket协议解析
- ✅ 消息回显功能
- ✅ 二进制数据十六进制转储
- ✅ 详细的连接日志
- ✅ 拆包粘包处理
- ✅ 优雅关闭

## 使用方法

### 1. 安装Node.js

首先确保你的系统已安装Node.js：
- 下载地址：https://nodejs.org/
- 推荐版本：Node.js 16+ 

### 2. 启动测试服务器

在此目录下运行：

```bash
node test-server.js
```

你应该看到类似的输出：
```
🚀 Unity SuperSocket 测试服务器已启动
📍 监听地址: 0.0.0.0:8080
📝 日志文件: server.log
🔧 协议解析: 启用
📊 二进制日志: 启用
✨ 准备接受客户端连接...
```

### 3. 连接Unity客户端

在Unity中运行BasicNetworkClient或ProtoBufChatClient示例，服务器地址设为：
- Host: `127.0.0.1`
- Port: `8080`

## 协议支持

### Unity SuperSocket协议格式

服务器能够解析以下协议格式：

```
[4字节总长度][2字节消息ID][4字节客户端序列号][2字节服务器ID][消息数据]
```

- **总长度**: 包含自身4字节在内的整个消息长度 (小端序)
- **消息ID**: 消息类型标识符 (小端序)
- **客户端序列号**: 用于请求-响应匹配 (小端序)
- **服务器ID**: 目标服务器标识 (小端序)
- **消息数据**: 实际的消息内容 (ProtoBuf或原始字节)

## 服务器配置

你可以修改`test-server.js`中的CONFIG对象来调整设置：

```javascript
const CONFIG = {
    port: 8080,                    // 监听端口
    host: '0.0.0.0',              // 监听地址
    logFile: 'server.log',         // 日志文件名
    enableBinaryLog: true,         // 启用二进制数据日志
    enableProtocolParsing: true    // 启用协议解析
};
```

## 日志输出示例

### 客户端连接
```
[2023-10-15T10:30:15.123Z] 🔗 客户端#1 已连接: ::ffff:127.0.0.1:54321
```

### 消息接收与解析
```
[2023-10-15T10:30:16.456Z] 📨 客户端#1 发送了 25 字节
[2023-10-15T10:30:16.457Z] 📨 客户端#1 数据:
0000: 19 00 00 00 E9 03 01 00 00 00 01 00 48 65 6C 6C  ............Hell
0010: 6F 20 53 65 72 76 65 72 21                       o Server!

[2023-10-15T10:30:16.458Z] 🔍 处理客户端#1的消息 (25 字节)
[2023-10-15T10:30:16.459Z] ✅ 客户端#1 协议解析成功:
   - 总长度: 25
   - 消息ID: 1001
   - 客户端序列号: 1
   - 服务器ID: 1
   - 消息数据长度: 13
   - 消息内容: "Hello Server!"
```

### 响应发送
```
[2023-10-15T10:30:16.460Z] 📤 客户端#1 响应已发送 (38 字节)
[2023-10-15T10:30:16.461Z] 📤 客户端#1 响应数据:
0000: 26 00 00 00 EA 03 01 00 00 00 01 00 53 65 72 76  &...........Serv
0010: 65 72 20 72 65 63 65 69 76 65 64 3A 20 48 65 6C  er received: Hel
0020: 6C 6F 20 53 65 72 76 65 72 21                    lo Server!
```

## 测试场景

### 基础连接测试
1. 启动测试服务器
2. 运行BasicNetworkClient示例
3. 观察连接状态和消息收发

### ProtoBuf消息测试
1. 启动测试服务器  
2. 运行ProtoBufChatClient示例
3. 发送聊天消息，观察协议解析

### 并发连接测试
1. 启动测试服务器
2. 同时运行多个客户端实例
3. 观察服务器如何处理多个连接

## 故障排除

### 端口被占用
```bash
# Windows
netstat -ano | findstr :8080

# macOS/Linux  
lsof -i :8080
```

### 连接被拒绝
- 确保服务器已启动且监听正确端口
- 检查防火墙设置
- 确认客户端连接地址和端口正确

### 协议解析失败
- 检查客户端发送的数据格式
- 确认字节序（小端序）
- 查看二进制日志进行调试

## 停止服务器

使用 `Ctrl+C` 优雅关闭服务器，它会：
- 停止接受新连接
- 关闭现有连接
- 保存日志文件
- 正常退出程序

## 扩展功能

你可以根据需要修改服务器代码来添加：

- 不同的响应类型
- ProtoBuf消息解析
- 数据库集成
- WebSocket支持
- 负载均衡

这个测试服务器主要用于开发和测试目的，不建议在生产环境中使用。